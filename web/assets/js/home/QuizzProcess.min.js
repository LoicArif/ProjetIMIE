var href;$(document).ready(function(){var pT;try{getQuestionSetIntoLocalStorage(function(){genQuizz(getCookie("lastQuestionToStart"),function(){getImageValue();handleProgressBar();genImg();pT=new PageTransionner})})}catch(e){resetQuizz();var responseDiv=document.querySelector("#questionLabel");responseDiv.innerHTML="<h3>Il semble y avoir eu un probl√®me, veuillez actualiser la page ou contacter un administrateur</h3>";genImg()}function genQuizz(number,callback){var questionSetOne=JSON.parse(localStorage.getItem("questionSet"+number));document.querySelector("#questionLabel").innerHTML=questionSetOne.questionLabel;var responseLength=questionSetOne.responses.length;var ptMain=document.createElement("div");ptMain.id="pt-main";ptMain.className="pt-perspective";switch(responseLength){case 2:handleResponse(questionSetOne,false,ptMain,"col-md-6");break;case 3:handleResponse(questionSetOne,false,ptMain,"col-md-4");break;case 4:handleResponse(questionSetOne,false,ptMain,"col-md-6");break;case 5:handleResponse(questionSetOne,false,ptMain,"col-md-4",true);break;case 6:handleResponse(questionSetOne,false,ptMain,"col-md-4");break}if(!!JSON.parse(localStorage.getItem("questionSet"+(parseInt(number)+1)))){var questionSetTwo=JSON.parse(localStorage.getItem("questionSet"+(parseInt(number)+1)));responseLength=questionSetTwo.responses.length;switch(responseLength){case 2:handleResponse(questionSetTwo,true,ptMain,"col-md-6");break;case 3:handleResponse(questionSetTwo,true,ptMain,"col-md-4");break;case 4:handleResponse(questionSetTwo,true,ptMain,"col-md-6");break;case 5:handleResponse(questionSetTwo,true,ptMain,"col-md-4",true);break;case 6:handleResponse(questionSetTwo,true,ptMain,"col-md-4");break}}callback()}function handleResponse(questionSet,isSecond,ptMain,colDivClassName,bool){bool=bool||false;var responseContainer=document.querySelector("#responseContainer");var ptPage=document.createElement("div");ptPage.className="pt-page hidden";ptPage.id="first-pt-page";if(isSecond)ptPage.id="second-pt-page";var i=0;questionSet.responses.forEach(function(response){var colDiv=document.createElement("div");colDiv.className=colDivClassName;if(bool&&i===3)colDiv.className=colDivClassName+" col-md-offset-2";var thumbnail=document.createElement("a");thumbnail.className="thumbnail imgContent";thumbnail.setAttribute("data-value",response.value);thumbnail.setAttribute("data-temperament",questionSet.idTemperament);thumbnail.setAttribute("data-number",questionSet.questionNumber);thumbnail.setAttribute("data-href",document.querySelector("#hrefInput").value);thumbnail.id="imgContent"+i;var imgContent=document.createElement("img");imgContent.src="assets/img/imageResponse/"+response.imageName;imgContent.alt="Image indisponible";imgContent.width=document.querySelector("#widthInput").value;imgContent.height=document.querySelector("#heightInput").value;imgContent.style.width=document.querySelector("#widthInput").value;imgContent.style.height=document.querySelector("#heightInput").value;var responseLabel=document.createElement("h3");responseLabel.className="text-center subtitleQuizz";responseLabel.innerHTML=response.label;thumbnail.appendChild(imgContent);thumbnail.appendChild(responseLabel);colDiv.appendChild(thumbnail);ptPage.appendChild(colDiv);i++});ptMain.appendChild(ptPage);responseContainer.appendChild(ptMain)}function handleProgressBar(){var progressBar=$(".progress-bar");var questionNumber=parseInt(getCookie("lastQuestionToStart"))+1;var newWidth=(questionNumber-1)*100/getCookie("NumberOfQuestion");progressBar.attr("aria-valuemax",getCookie("NumberOfQuestion"));progressBar.attr("aria-valuenow",questionNumber);progressBar.css("width",newWidth+"%")}function getImageValue(){$(".imgContent").unbind("click").bind("click",function(){var value=$(this).data("value");var questionNumber=$(this).data("number");var temperamentId=$(this).data("temperament");var idImage=$(this).attr("id");href=$(this).data("href");var responseContent={value:value,temperamentId:temperamentId,idImage:idImage};setCookie("responseContent"+questionNumber,JSON.stringify(responseContent),1);nextQuestion(questionNumber,href)})}function nextQuestion(questionNumber,href){if(questionNumber<getCookie("NumberOfQuestion")-1){setCookie("lastQuestionToStart",parseInt(questionNumber)+1,1);pT.nextPage(function(){nextLoadingProcess(function(){getImageValue();handleProgressBar();genImg()})});function nextLoadingProcess(callback){var firstPtPage=$("#first-pt-page");var secondPtPage=$("#second-pt-page");var number=getCookie("lastQuestionToStart");var questionSet;questionSet=JSON.parse(localStorage.getItem("questionSet"+number));document.querySelector("#questionLabel").innerHTML=questionSet.questionLabel;var responseLength=questionSet.responses.length;if(number%2===0){switch(responseLength){case 2:loading(firstPtPage,"col-md-6");break;case 3:loading(firstPtPage,"col-md-4");break;case 4:loading(firstPtPage,"col-md-6");break;case 5:loading(firstPtPage,"col-md-4",true);break;case 6:loading(firstPtPage,"col-md-4");break}}if(number%2!==0){switch(responseLength){case 2:loading(secondPtPage,"col-md-6");break;case 3:loading(secondPtPage,"col-md-4");break;case 4:loading(secondPtPage,"col-md-6");break;case 5:loading(secondPtPage,"col-md-4",true);break;case 6:loading(secondPtPage,"col-md-4");break}}function loading(ptPage,colDivMd,bool){bool=bool||false;ptPage.html("");var i=0;questionSet.responses.forEach(function(response){var colDiv=document.createElement("div");colDiv.className=colDivMd;if(bool&&i===3)colDiv.className=colDivMd+" col-md-offset-2";var thumbnail=document.createElement("a");thumbnail.className="thumbnail imgContent";thumbnail.setAttribute("data-value",response.value);thumbnail.setAttribute("data-temperament",questionSet.idTemperament);thumbnail.setAttribute("data-number",questionSet.questionNumber);thumbnail.setAttribute("data-href",document.querySelector("#hrefInput").value);thumbnail.id="imgContent"+i;var imgContent=document.createElement("img");imgContent.src="assets/img/imageResponse/"+response.imageName;imgContent.alt="Image indisponible";imgContent.width=document.querySelector("#widthInput").value;imgContent.height=document.querySelector("#heightInput").value;imgContent.style.width=document.querySelector("#widthInput").value;imgContent.style.height=document.querySelector("#heightInput").value;var responseLabel=document.createElement("h3");responseLabel.className="text-center subtitleQuizz";responseLabel.innerHTML=response.label;thumbnail.appendChild(imgContent);thumbnail.appendChild(responseLabel);colDiv.appendChild(thumbnail);ptPage.append(colDiv);i++})}callback()}}else{grecaptcha.execute()}}function genImg(){var imgs=[];var perso=document.querySelector("#perso");for(var i=2;i<9;i++){imgs.push("perso_pose"+i)}var img=imgs[Math.floor(Math.random()*imgs.length)];perso.src="assets/img/perso/"+img+".png"}});function resolveQuizz(){var responses=[];var body=$("#my-body");for(var i=0;i<getCookie("NumberOfQuestion");i++){responses.push(JSON.parse(getCookie("responseContent"+i)))}$.ajax({url:href,type:"POST",data:{responses:responses},beforeSend:function(){$("#modalLoading").modal("show")}}).done(function(result){setTimeout(function(){resetQuizz();body.hide().html("").fadeOut("slow");body.html(result.page).fadeIn("slow");var head=$("head");head.remove();window.history.pushState("","",result.href);$("html").css("overflow","auto");head=document.createElement("head");head.id="myhead";$(".head").wrapAll(head);$("html").prepend($("#myhead"));setTimeout(function(){$("#modalLoading").hide();$("body").removeClass("modal-open");$(".modal-backdrop").remove()},600)},1e3)}).fail(function(){})}function getQuestionSetIntoLocalStorage(callback){if(getCookie("NumberOfQuestion")<=0||getCookie("lastQuestionToStart").length<=0){setCookie("lastQuestionToStart",0,1);$.ajax({url:"/questionSet",type:"GET",async:false}).done(function(result){var j=0;result.forEach(function(questionSet){var objectSet={};objectSet.idTemperament=questionSet.temperament.id;questionSet.questions.forEach(function(objectQuestion){objectSet.questionNumber=objectQuestion.questionNumber;objectSet.questionLabel=objectQuestion.question[0].label;objectSet.responses=objectQuestion.question[1];localStorage.setItem("questionSet"+j,JSON.stringify(objectSet));j++})});setCookie("NumberOfQuestion",j)})}callback()}function setCookie(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+exdays*24*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/"}function getCookie(cname){var name=cname+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)===" "){c=c.substring(1)}if(c.indexOf(name)===0){return c.substring(name.length,c.length)}}return""}function deleteAllCookies(){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=cookies[i];var eqPos=cookie.indexOf("=");var name=eqPos>-1?cookie.substr(0,eqPos):cookie;document.cookie=name+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}function resetQuizz(){localStorage.clear();deleteAllCookies()}function redirect(redirectUrl,arg,value){var form=$('<form action="'+redirectUrl+'" method="post">'+'<input type="hidden" name="'+arg+'" value="'+value+'"></input>'+"</form>");$("body").append(form);$(form).submit()}